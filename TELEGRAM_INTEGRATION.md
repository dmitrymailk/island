# Интеграция с Telegram WebApp

## Обзор

Добавлен функционал импорта друзей из Telegram в приложение Островок. Пользователи могут импортировать контакты из своего Telegram и добавлять их в список друзей для просмотра рекомендаций.

## Новые компоненты

### 1. `hooks/useTelegramContacts.ts`
Хук для работы с Telegram WebApp API через `@twa-dev/sdk`:
- Проверка доступности Telegram WebApp
- Запрос контактов пользователя через оригинальный API
- Конвертация контактов Telegram в формат Friend
- Показ уведомлений и подтверждений через SDK

### 2. `components/TelegramContactsImport.tsx`
Основной компонент для импорта контактов:
- Пошаговый интерфейс импорта
- Выбор контактов для добавления
- Обработка ошибок и состояний загрузки
- Автоматическое переключение в тестовый режим вне Telegram

### 3. `components/TelegramTestMode.tsx`
Компонент для тестирования вне Telegram WebApp:
- Демонстрация функционала с моковыми данными
- Полная имитация интерфейса импорта
- Позволяет тестировать функционал в браузере

## Интеграция

### Страница приглашения друзей (`pages/InvitePage.tsx`)
- Добавлена кнопка "Импорт из Telegram"
- Модальное окно с компонентом импорта
- Интеграция с существующим функционалом добавления друзей

### Страница друзей (`pages/FriendsPage.tsx`)
- Кнопка "Импорт из Telegram" в шапке страницы
- Модальное окно для быстрого доступа к импорту
- Обновлен интерфейс для поддержки добавления друзей

## Настройка

### 1. Установка зависимостей
```bash
npm install @twa-dev/sdk
```

### 2. Подключение Telegram WebApp API
В `index.html` добавлен скрипт Telegram WebApp:
```html
<script src="https://telegram.org/js/telegram-web-app.js"></script>
```

### 3. Инициализация
В `index.tsx` добавлена инициализация через `@twa-dev/sdk`:
```typescript
import WebApp from '@twa-dev/sdk';

if (typeof window !== 'undefined' && WebApp.initDataUnsafe?.user) {
  WebApp.ready();
  WebApp.expand();
}
```

## Использование

### В Telegram WebApp
1. Пользователь нажимает "Импорт из Telegram"
2. Запрашивается разрешение на доступ к контактам
3. Показываются найденные контакты
4. Пользователь выбирает контакты для добавления
5. Выбранные контакты добавляются в друзья

### Вне Telegram WebApp (тестовый режим)
1. Показывается предупреждение о тестовом режиме
2. Отображаются демонстрационные контакты
3. Функционал работает аналогично реальному режиму

## Безопасность

- Все операции выполняются на клиентской стороне
- Контакты не передаются на сервер
- Используются только официальные API Telegram
- Запрашиваются только необходимые разрешения

## Типы данных

### TelegramContact
```typescript
interface TelegramContact {
  user_id: number;
  first_name: string;
  last_name?: string;
  username?: string;
  phone_number?: string;
}
```

### Конвертация в Friend
Контакты Telegram автоматически конвертируются в формат `Friend`:
- `id`: `tg_${user_id}`
- `name`: полное имя (first_name + last_name)
- `avatarUrl`: сгенерированный аватар
- `source`: `'telegram'`

## Обработка ошибок

- Проверка доступности Telegram WebApp
- Обработка отказа в доступе к контактам
- Показ понятных сообщений об ошибках
- Graceful fallback в тестовый режим

## Совместимость

- Работает в Telegram WebApp (основной режим)
- Работает в обычном браузере (тестовый режим)
- Поддерживает все современные браузеры
- Адаптивный дизайн для мобильных устройств
