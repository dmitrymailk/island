### Как запустить

1. Установите Node.js (рекомендуется LTS 18+ или 20+).

2. **Настройте переменные окружения (опционально):**

Создайте файл `.env` в корне проекта для настройки параметров:

```env
# URL сервера для импорта контактов Telegram
VITE_TELEGRAM_SERVER_URL=http://localhost:3001
```

**Примечание:** Если `.env` файл не создан, будут использоваться значения по умолчанию.

3. Установите зависимости:

```bash
npm install
```

4. Запустите дев-сервер:

```bash
npm run dev
```

Откройте `http://localhost:5173` в браузере.

5. Сборка прод-версии:

```bash
npm run build
```

6. Локальный предпросмотр сборки:

```bash
npm run preview
```

### Запуск серверной части (Telegram Bot + API)

**⚠️ ВАЖНО для деплоя на GitHub Pages:** Если вы деплоите фронтенд на GitHub Pages (HTTPS), вам нужно настроить HTTPS на сервере. См. [HTTPS_SETUP.md](HTTPS_SETUP.md)

Серверная часть находится в папке `server/` и включает в себя:
- Telegram бота для импорта контактов
- Express API сервер для работы с контактами  
- Nginx reverse proxy с SSL (для HTTPS)
- Файловое хранилище контактов (`db.json`)

#### Предварительные требования

1. **Создайте Telegram бота:**
   - Напишите [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/newbot`
   - Следуйте инструкциям и получите токен бота

2. **Настройте переменные окружения:**

Создайте файл `.env` в **корне проекта** со следующим содержимым:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_от_BotFather
PORT=3001
```

#### Запуск сервера

**Вариант 1: С автоперезагрузкой (для разработки)**

```bash
npm run server
```

Сервер автоматически перезапускается при изменении файлов благодаря `nodemon`.

**Вариант 2: Обычный запуск**

```bash
node server/index.js
```

#### Проверка работы

1. **Сервер должен вывести:**
   ```
   Бот @ваш_бот успешно запущен...
   Сервер API запущен на http://localhost:3001
   ```

2. **Проверьте бота в Telegram:**
   - Найдите своего бота по имени
   - Отправьте команду `/start`
   - Бот должен попросить поделиться контактами

3. **Проверьте API:**
   ```bash
   curl http://localhost:3001/api/contacts/427649895
   ```

#### Как это работает

**Структура сервера:**
```
server/
├── index.js    # Основной файл сервера
└── db.json     # Хранилище контактов (создается автоматически)
```

**Основные компоненты:**

1. **Telegram Bot** - принимает контакты от пользователей:
   - Команда `/start` - приветствие
   - Отправка контакта - сохранение в базу
   - Автоматическая проверка дубликатов

2. **Express API сервер** - предоставляет REST API:
   - `GET /api/contacts/:userId` - получить контакты пользователя
   - `DELETE /api/contacts/:userId` - удалить контакты

3. **Файловое хранилище** - `db.json`:
   - Автоматически загружается при старте
   - Автоматически сохраняется при изменениях
   - Формат: `{ "userId": [контакты] }`

#### API Endpoints

**Получить контакты пользователя:**
```bash
GET /api/contacts/:userId
```

Пример ответа:
```json
[
  {
    "phone_number": "+79272587856",
    "first_name": "Арина",
    "last_name": "Капшук",
    "user_id": 5457930994
  }
]
```

**Удалить контакты:**
```bash
DELETE /api/contacts/:userId
Content-Type: application/json

{
  "phones": ["+79272587856"]
}
```

#### Troubleshooting

**Проблема:** `Ошибка: Пожалуйста, создайте файл .env`  
**Решение:** Создайте файл `.env` в корне проекта с токеном бота

**Проблема:** `Error: 401 Unauthorized`  
**Решение:** Проверьте правильность токена в `.env` файле

**Проблема:** Порт 3001 уже занят  
**Решение:** Измените порт в `.env`:
```env
PORT=3002
```

**Проблема:** Бот не отвечает  
**Решение:** 
- Проверьте, что сервер запущен
- Убедитесь, что бот не запущен в другом месте
- Проверьте логи сервера

#### Безопасность

⚠️ **Важно:** Никогда не коммитьте файл `.env` в git! Он уже добавлен в `.gitignore`.

#### Запуск сервера через Docker

Серверная часть также может быть запущена в Docker контейнере. Подробная документация находится в `server/README.md`.

**Быстрый старт:**

```bash
cd server
docker compose up -d
```

**Просмотр логов:**
```bash
docker compose logs -f
```

**Остановка:**
```bash
docker compose down
```

См. [server/README.md](server/README.md) для подробной информации.

### Конфигурация сервера API

По умолчанию фронтенд подключается к серверу на `http://localhost:3001`. Вы можете изменить это поведение:

#### Вариант 1: Через переменные окружения (рекомендуется)

Создайте или отредактируйте файл `.env` в корне проекта:

```env
VITE_TELEGRAM_SERVER_URL=http://your-server-address:3001
```

#### Вариант 2: Прямое редактирование конфигурации

Отредактируйте файл `config.ts`:

```typescript
export const API_CONFIG = {
  TELEGRAM_SERVER_URL: 'http://your-server-address:3001',
  // ...
};
```

#### Примеры настройки для разных окружений

**Локальная разработка:**
```env
VITE_TELEGRAM_SERVER_URL=http://localhost:3001
```

**Сервер в той же сети:**
```env
VITE_TELEGRAM_SERVER_URL=http://192.168.1.100:3001
```

**Удаленный сервер:**
```env
VITE_TELEGRAM_SERVER_URL=https://api.example.com
```

**Docker контейнер:**
```env
VITE_TELEGRAM_SERVER_URL=http://telegram-bot-server:3001
```

**Примечание:** После изменения `.env` файла необходимо перезапустить dev-сервер.

### Деплой на GitHub Pages

Проект настроен для ручного деплоя на GitHub Pages с использованием GitHub Actions.

#### Автоматический деплой через GitHub Actions

При каждом push в ветку `main` автоматически запускается процесс сборки и деплоя.

**Workflow делает следующее:**
1. Устанавливает зависимости
2. Собирает проект с переменной окружения `VITE_TELEGRAM_SERVER_URL=https://147.45.213.244`
3. Публикует собранные файлы на GitHub Pages

**Для настройки:**
1. Загрузите код в GitHub репозиторий
2. В настройках репозитория перейдите в раздел "Pages"
3. В разделе "Source" выберите "GitHub Actions"
4. Push в ветку `main` автоматически запустит деплой

**Для ручного деплоя:**
1. Перейдите в раздел "Actions" репозитория
2. Выберите workflow "Deploy to GitHub Pages"
3. Нажмите "Run workflow" и выберите ветку `main`
4. Дождитесь завершения деплоя

#### Локальный деплой
```bash
npm run deploy
```

**Примечание:** Локальный деплой требует настройки GitHub токена и может иметь ограничения по правам доступа.

После деплоя сайт будет доступен по адресу: `https://dmitrymailk.github.io/island/`

#### Изменение IP сервера бота

IP адрес сервера Telegram бота захардкоден в файле `.github/workflows/deploy.yml`:

```yaml
env:
  VITE_TELEGRAM_SERVER_URL: https://147.45.213.244
```

Для изменения адреса сервера отредактируйте этот файл и сделайте commit.

### Запуск через Docker Compose

1. Установите Docker и Docker Compose.
2. Соберите и запустите контейнер:

```bash
docker compose up -d
```

3. Откройте в браузере `http://localhost:3000`.

Остановка контейнеров:

```bash
docker compose down
```

### Описание с сайта
Трек «Друзья рекомендуют»
Проблематика
В индустрии путешествий выбор отеля часто определяется не только ценой и фотографиями, но и доверием к источнику рекомендаций. Официальные отзывы могут казаться обезличенными, а алгоритмы подбора недостаточно персональными. 

При этом мы знаем, что рекомендации друзей и знакомых воспринимаются как более надёжные и актуальные. Однако у большинства сервисов бронирования, и у нас в том числе, нет удобного механизма для получения и использования таких рекомендаций. Пользователи спрашивают рекомендации напрямую у друзей, ищут советы в открытых источниках, либо ориентируются на случайные виральные видео в соцсетях.

Друзья рекомендуют - это функционал, который позволяет путешественнику получить персонализированные рекомендации отелей на основе отзывов и опыта его друзей и знакомых. Такой функционал даст возможность:

находить отели, в которых уже останавливались друзья;

получать свежие, проверенные и релевантные именно для пользователя отзывы;

повышать вовлечённость и лояльность аудитории платформы.



Формулировка задания
Необходимо разработать прототип функционала “Друзья рекомендуют” для Островка.

Он должен позволить пользователю находить подходящие отели в которых останавливались его друзья, подписчики, коллеги и видеть их отзывы. 



User Story
Как путешественник, я хочу видеть рекомендации отелей от своих друзей и знакомых, чтобы быть уверенным в их качестве и актуальности.

Как компания Островок, я хочу предложить пользователям более персонализированный подбор на основе социальных связей, чтобы увеличить вовлечённость, доверие и конверсию в бронирование.

Как владелец отеля, я хочу, чтобы мои довольные гости могли легко рекомендовать мой отель своим друзьям.



Мы в Островке ценим свежие идеи и нестандартные подходы. Мы вас никак не ограничиваем в подходах, которые вы будете использовать и в самой реализации.
Вы можете предложить собственные способы получения и обработки социальных данных, а также придумать свои механики для того, чтобы делиться отзывами и подключать друзей.



Ожидаемый результат
MVP, в котором можно пройти весь путь от подключения списка друзей до непосредственной визуализации персонализированных рекомендаций отелей.



Основные задачи
Выдача отелей с рекомендациями

Отображение списка друзей, которые оставляли отзывы. И вся необходимая информация об отелях и о самих отзывах

Интеграция с соцсетями и/или контактами или альтернативные способы получения информации о знакомых

Механизм импорта и синхронизации контактов(с разрешения пользователя)

Отображение рекомендаций в карточке отеля

Плашка «рекомендовано другом» с кратким комментарием или оценкой

Админ-панель: управление источниками данных, модерация отзывов и т.д.



Дополнительные задачи
Система геймификации (бейджи за рекомендации, рейтинг по числу приглашённых друзей).

Общая аналитика, которая может понадобиться нашим менеджерам, которые будут заниматься развитием программы “Друзья рекомендуют”.

Мобильная версия или адаптивная веб-версия.

