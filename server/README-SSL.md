# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS –¥–ª—è Telegram Bot Server

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS –¥–ª—è –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ Mixed Content –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ GitHub Pages.

## üîí –ü—Ä–æ–±–ª–µ–º–∞

GitHub Pages —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS, –Ω–æ –µ—Å–ª–∏ –≤–∞—à API —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTP, –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –æ—à–∏–±–∫–æ–π:
```
Mixed Content: The page was loaded over HTTPS, but requested an insecure resource 'http://...'
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: Nginx —Å SSL

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Nginx –∫–∞–∫ reverse proxy —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º.

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –ë—Ä–∞—É–∑–µ—Ä –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

1. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
```bash
cd server
chmod +x generate-ssl-cert.sh
./generate-ssl-cert.sh
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å Nginx:**
```bash
docker compose up -d
```

3. **–í–∞—à API —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS:**
```
https://147.45.213.244/api/contacts/427649895
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Let's Encrypt (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞) ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** 
- –î–æ–º–µ–Ω, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `api.yourdomain.com`)
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã 80 –∏ 443

**–®–∞–≥–∏:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install certbot

# CentOS/RHEL
sudo yum install certbot
```

2. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**
```bash
cd server
docker compose down
```

3. **–ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ yourdomain.com –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
sudo certbot certonly --standalone -d api.yourdomain.com
```

4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:**
```bash
sudo mkdir -p ./ssl
sudo cp /etc/letsencrypt/live/api.yourdomain.com/fullchain.pem ./ssl/cert.pem
sudo cp /etc/letsencrypt/live/api.yourdomain.com/privkey.pem ./ssl/key.pem
sudo chmod 644 ./ssl/cert.pem
sudo chmod 644 ./ssl/key.pem
```

5. **–û–±–Ω–æ–≤–∏—Ç–µ nginx.conf:**
```nginx
server_name api.yourdomain.com;  # –ó–∞–º–µ–Ω–∏—Ç–µ IP –Ω–∞ –¥–æ–º–µ–Ω
```

6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
docker compose up -d
```

7. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:**
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
sudo crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00):
0 2 * * * certbot renew --quiet --deploy-hook "cd /path/to/server && ./update-ssl.sh"
```

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `update-ssl.sh`:
```bash
#!/bin/bash
cp /etc/letsencrypt/live/api.yourdomain.com/fullchain.pem ./ssl/cert.pem
cp /etc/letsencrypt/live/api.yourdomain.com/privkey.pem ./ssl/key.pem
docker compose restart nginx
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ IP —Å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –¥–æ–º–µ–Ω–∞, –Ω–æ –Ω—É–∂–µ–Ω HTTPS –¥–ª—è API:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç 1)

2. **–î–æ–±–∞–≤—å—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `https://147.45.213.244` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "–í–∞—à–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ"
   - –ù–∞–∂–º–∏—Ç–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ" ‚Üí "–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ)"
   - –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

3. **–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `https://147.45.213.244` –≤ Safari/Chrome
   - –ü—Ä–∏–º–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É –≤–∞—Å –±—É–¥–µ—Ç:

```
server/
‚îú‚îÄ‚îÄ ssl/                    # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ cert.pem           # –ü—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
‚îÇ   ‚îî‚îÄ‚îÄ key.pem            # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
‚îú‚îÄ‚îÄ nginx.conf             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ docker-compose.yml     # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π compose —Å Nginx
‚îú‚îÄ‚îÄ generate-ssl-cert.sh   # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
‚îî‚îÄ‚îÄ README-SSL.md          # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã:
```bash
docker compose ps
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:
- `ostrovok-telegram-bot`
- `ostrovok-nginx`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx:
```bash
docker compose logs nginx
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:
```bash
curl -k https://147.45.213.244/api/contacts/YOUR_USER_ID
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools ‚Üí Network –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –ø–æ HTTPS.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- **80** (HTTP) ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
- **443** (HTTPS) ‚Üí –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ Express (3001)
- **3001** (Express) ‚Üí –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏

**–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤** –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`:
```yaml
nginx:
  ports:
    - "8080:80"    # HTTP –Ω–∞ –ø–æ—Ä—Ç—É 8080
    - "8443:443"   # HTTPS –Ω–∞ –ø–æ—Ä—Ç—É 8443
```

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "SSL certificate problem: self signed certificate"

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `-k` –≤ curl –∏–ª–∏ –ø—Ä–∏–º–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt (–í–∞—Ä–∏–∞–Ω—Ç 2)

### –û—à–∏–±–∫–∞: "ERR_SSL_PROTOCOL_ERROR"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 443 –æ—Ç–∫—Ä—ã—Ç –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ:
```bash
sudo ufw allow 443
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
```bash
ls -la ./ssl/
```

### –û—à–∏–±–∫–∞: "Mixed Content" –≤—Å–µ –µ—â–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS URL:
```env
VITE_TELEGRAM_SERVER_URL=https://147.45.213.244
```

2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

3. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞

### Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker compose exec nginx nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose restart nginx
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏** (`key.pem`) –≤ git
   - –î–æ–±–∞–≤—å—Ç–µ `ssl/*.pem` –≤ `.gitignore`

2. **–°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –ù–ï –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
   - –ë—Ä–∞—É–∑–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
   - –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç MITM –∞—Ç–∞–∫

3. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**
   - Let's Encrypt (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π)
   - –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
   - Cloudflare SSL (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**
   - Let's Encrypt: –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ: –æ–±—ã—á–Ω–æ –µ–∂–µ–≥–æ–¥–Ω–æ

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Let's Encrypt Documentation](https://letsencrypt.org/docs/)
- [Nginx SSL Configuration](https://nginx.org/en/docs/http/configuring_https_servers.html)
- [Mozilla SSL Configuration Generator](https://ssl-config.mozilla.org/)

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å HTTP –Ω–∞ HTTPS

–ï—Å–ª–∏ –≤—ã —É–∂–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ HTTP:

1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä:**
```bash
docker compose down
```

2. **–°–æ–∑–¥–∞–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** (—Å–º. –≤—ã—à–µ)

3. **–û–±–Ω–æ–≤–∏—Ç–µ docker-compose.yml** (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å Nginx:**
```bash
docker compose up -d
```

5. **–û–±–Ω–æ–≤–∏—Ç–µ URL –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**
```yaml
# .github/workflows/deploy.yml
VITE_TELEGRAM_SERVER_URL: https://147.45.213.244
```

6. **–ü–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥**
